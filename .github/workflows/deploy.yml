name: Deploy to Namecheap

on:
  push:
    branches: [ master ]
  workflow_dispatch:
    inputs:
      server:
        description: 'FTP server address (e.g. ftp.beelsimon.com)'
        required: false
        default: 'ftp.beelsimon.com'

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    
    steps:
    - name: üöö Get latest code
      uses: actions/checkout@v4
      
    - name: üîß Prepare hosting-specific files
      run: |
        # Copy hosting-specific index.php
        cp public/index-hosting.php public/index.php
      
    - name: üîç Debug server configuration
      run: |
        echo "Server from input: '${{ github.event.inputs.server }}'"
        echo "Fallback server: 'ftp.beelsimon.com'"
        echo "Final server: '${{ github.event.inputs.server || 'ftp.beelsimon.com' }}'"
      
    - name: üìÇ Sync application files to hosting
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      env:
        INPUT_SERVER: ${{ github.event.inputs.server || 'ftp.beelsimon.com' }}
      with:
        server: ${{ github.event.inputs.server || 'ftp.beelsimon.com' }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        protocol: ftp
        port: 21
        passive: true
        timeout: 300000
        dangerous-clean-slate: false
        local-dir: ./
        server-dir: tc_app/
        exclude: |
          **/.git*
          **/.git*/**
          **/node_modules/**
          **/tests/**
          **/.env
          **/storage/logs/**
          **/storage/framework/cache/**
          **/storage/framework/sessions/**
          **/storage/framework/views/**
          **/public/**
          
    - name: üåê Sync public files to web directory
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      env:
        INPUT_SERVER: ${{ github.event.inputs.server || 'ftp.beelsimon.com' }}
      with:
        server: ${{ github.event.inputs.server || 'ftp.beelsimon.com' }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        protocol: ftp
        port: 21
        passive: true
        timeout: 300000
        dangerous-clean-slate: false
        local-dir: ./public/
        server-dir: public_html/tc/
