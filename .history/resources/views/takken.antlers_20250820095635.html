{{ layout:set in="layouts/page" }}

<style>
@import url('/assets/css/takken.css');
</style>

<div class="page-section">
    <h2>{{ title }}</h2>
    <p class="section-intro">
        {{ intro_text | nl2br }}
    </p>
    
    <div id="takken-container" class="grid-2">
        {{ takken_groepen }}
            <div class="tak-card card">
                <div class="card-content">
                    <div class="tak-header">
                        {{ if logo }}
                            <img src="{{ glide:logo width='100' height='100' fit='crop' }}" alt="{{ naam }} logo" class="tak-logo">
                        {{ else }}
                            <img src="/assets/images/takken/default-tak-logo.jpg" alt="{{ naam }} logo" class="tak-logo">
                        {{ /if }}
                        <h3>{{ naam }}</h3>
                    </div>
                    <div class="tak-leeftijd">{{ leeftijd }}</div>
                    <div class="tak-takken">
                        <strong>Takken:</strong> {{ takken_lijst | join:', ' }}
                    </div>
                    <p>{{ beschrijving }}</p>
                    
                    {{ if activiteiten }}
                    <div class="tak-activiteiten">
                        <strong>Activiteiten:</strong>
                        <ul>
                            {{ activiteiten }}
                                <li>{{ value }}</li>
                            {{ /activiteiten }}
                        </ul>
                    </div>
                    {{ /if }}
                    
                    <div class="tak-leiding">
                        <strong>Contact:</strong><br>
                        {{ if contact_naam }}{{ contact_naam }}<br>{{ /if }}
                        {{ if contact_email }}
                            <a href="mailto:{{ contact_email }}">{{ contact_email }}</a>
                        {{ else }}
                            <a href="mailto:groepsleiding@thilacoloma.be">groepsleiding@thilacoloma.be</a><br>
                            <small>Voor specifieke takleiding contactgegevens</small>
                        {{ /if }}
                    </div>
                    
                    <div class="tak-links">
                        <button class="btn btn-primary meer-info-btn" onclick="handleMeerInfo('{{ naam }}')">Meer info</button>
                    </div>
                </div>
            </div>
        {{ /takken_groepen }}
    </div>
</div>
                        kleur: "primary",
                        takken: ["Tictak (Akabe)"]
                    },
                    jongverkenners: {
                        naam: "Jongverkenners",
                        leeftijd: "Geboortejaar 2011-2013",
                        logo: "/assets/images/takken/Takteken_jonggidsen-jongverkenners-scheepsmakkers_hr_rgb web 2020.jpg",
                        beschrijving: "Jongverkenners zijn jonge scouts van 11 tot 13 jaar. Ze zijn niet bang van een beetje avontuur en om reeds zelf de handen uit de mouwen te steken. Jongverkenners slapen in patrouilletenten, stappen een 3-daagse met rugzak, koken zelf op een houtvuur, gaan met de fiets op weekend... Ze leren samenwerken, verkennen en ondernemen, engagement tonen, samen overleggen en zich voor anderen in te zetten. Zo ontdekken ze stilaan wat scouting echt inhoudt, ze zeggen hun belofte met trots en leren dat scouting ook niet stopt wanneer de vergadering afgelopen is... In TC hebben we 3 JV-takken met ongeveer 35 leden.",
                        activiteiten: ["patrouilletenten", "3-daagse hikes", "koken op houtvuur", "fietsweekends", "technische proeven"],
                        kleur: "primary",
                        takken: ["Jongverkenners 1", "Jongverkenners 2", "Jongverkenners 3"]
                    },
                    verkenners: {
                        naam: "Verkenners",
                        leeftijd: "Geboortejaar 2008-2010",
                        logo: "/assets/images/takken/Takteken_(zee)gidsen-verkenners_hr_rgb web2020.jpg",
                        beschrijving: "Verkenners zijn jongens en meisjes tussen 15 en 17 jaar. Verkenners bieden we alle kansen om te bewijzen wat ze in hun mars hebben. Er is ruimte om te experimenteren en mee te beslissen. Grootse projecten kleuren hun scoutsdag, maar gewoon gezellig samen zijn hoort er ook bij. Deze pubers hebben veel in hun mars, maar soms durven ze al eens een grote mond opzetten. Ze zijn op zoek naar zichzelf, een ontdekkingsreis die ze op deze leeftijd volop beleven. Bij TC maken Verkenners unieke momenten mee; ze krijgen hun totem, gaan voor het eerst op buitenlands kamp... We hebben 3 Verkennergroepen met elk ongeveer 30 leden.",
                        activiteiten: ["totems krijgen", "buitenlands kamp", "grootse projecten", "experimenteren", "groepsbeslissingen"],
                        kleur: "dark",
                        takken: ["Verkenners 1", "Verkenners 2", "Verkenners 3"]
                    },
                    voortrekkers: {
                        naam: "Voortrekkers",
                        leeftijd: "Geboortejaar 2007",
                        logo: "/assets/images/takken/Takteken_jins-loodsen_hr_rgb web2020.jpg",
                        beschrijving: "Jins (Jij en Ik Noodzaak) zijn 18 jaar en beleven hun laatste scoutsjaar als 'kindje', voor ze leiding worden. In TC gebruiken we de oude benaming voor Jins: Voortrekkers. De Vt's zijn zoekers. Met open ogen en een grote gulzigheid staan ze in het leven. Keuzes zijn er bij de vleet: pedagogie of informatica, Leuven of Gent, scouting of basket. Vt's proberen hun eigen doelen en verwachtingen te realiseren en genieten dan ook van de vrijheid en de zelfstandigheid die ze in hun tak krijgen. Bij TC staan de Vt's een keer per maand bij een andere tak in leiding, om al eens van het leiding-zijn te kunnen proeven. Ook op binnenlands kamp in augustus staan ze een heel kamp in leiding bij de tak van hun keuze. In juli gaan de Vt's op hun eigen buitenlands kamp.",
                        activiteiten: ["leiding ervaring", "buitenlands kamp", "klusjes doen", "projecten organiseren", "zelfstandigheid"],
                        kleur: "primary",
                        takken: ["Voortrekkers"]
                    }
                };
                
                // Create cards for grouped takken
                Object.values(groupedTakken).forEach(groep => {
                    const takCard = document.createElement('div');
                    takCard.className = 'tak-card card';
                    
                    // Find specific takken data for this group
                    const relevantTakken = data.takken.filter(tak => {
                        // Special case for Tictak matching
                        if (groep.naam === "Tictak (Akabe)" && tak.naam === "Tictak (Akabe)") {
                            return true;
                        }
                        // Normal matching for other groups
                        return groep.takken.includes(tak.naam);
                    });
                    
                    // Create leiding display - only show takleiders
                    let leidingInfo = '';
                    if (relevantTakken.length > 0) {
                        relevantTakken.forEach(tak => {
                            if (tak.leiding && tak.leiding.length > 0) {
                                // Find the takleider (first person or person with functie "Takleider")
                                const takleider = tak.leiding.find(leider => 
                                    leider.functie === "Takleider"
                                ) || tak.leiding[0];
                                
                                if (takleider && takleider.email) {
                                    leidingInfo += `<div class="tak-subgroep"><strong>${tak.naam}:</strong><br>`;
                                    leidingInfo += `${takleider.naam}<br>`;
                                    leidingInfo += `<a href="mailto:${takleider.email}">${takleider.email}</a><br>`;
                                    leidingInfo += '</div>';
                                }
                            }
                        });
                    }
                    
                    if (!leidingInfo) {
                        leidingInfo = `<a href="mailto:groepsleiding@thilacoloma.be">groepsleiding@thilacoloma.be</a><br><small>Voor specifieke takleiding contactgegevens</small>`;
                    }
                    
                    takCard.innerHTML = `
                        <div class="card-content">
                            <div class="tak-header">
                                <img src="${groep.logo}" alt="${groep.naam} logo" class="tak-logo">
                                <h3>${groep.naam}</h3>
                            </div>
                            <div class="tak-leeftijd">${groep.leeftijd}</div>
                            <div class="tak-takken">
                                <strong>Takken:</strong> ${groep.takken.join(', ')}
                            </div>
                            <p>${groep.beschrijving}</p>
                            <div class="tak-leiding">
                                <strong>Takleiders:</strong><br>
                                ${leidingInfo}
                            </div>
                            <div class="tak-links">
                                <button class="btn btn-primary meer-info-btn" onclick="handleMeerInfo('${groep.naam}')">Meer info</button>
                            </div>
                        </div>
                    `;
                    
                    takkenContainer.appendChild(takCard);
                });
            } catch (error) {
                console.error('Error loading takken:', error);
            }
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadTakken);
        
        // Handle meer info button clicks
        function handleMeerInfo(groepNaam) {
            switch(groepNaam) {
                case 'Kapoenen':
                    window.location.href = '/kapoenen';
                    break;
                case 'Welpen':
                    window.location.href = '/welpen';
                    break;
                case 'Tictak (Akabe)':
                    window.location.href = '/tictak';
                    break;
                case 'Jongverkenners':
                    window.location.href = '/jongverkenners';
                    break;
                case 'Verkenners':
                    window.location.href = '/verkenners';
                    break;
                case 'Voortrekkers':
                    window.location.href = '/voortrekkers';
                    break;
                default:
                    alert('Pagina niet gevonden!');
            }
        }
        
        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            
            function performSearch() {
                const query = searchInput.value.trim().toLowerCase();
                if (query === '') return;
                
                // Search through all text content on the page
                const sections = document.querySelectorAll('.page-section');
                let results = [];
                
                sections.forEach(section => {
                    const sectionTitle = section.querySelector('h2')?.textContent || '';
                    const sectionContent = section.textContent.toLowerCase();
                    
                    if (sectionContent.includes(query)) {
                        results.push({
                            title: sectionTitle,
                            element: section,
                            relevance: calculateRelevance(sectionContent, query)
                        });
                    }
                });
                
                // Highlight and scroll to most relevant result
                if (results.length > 0) {
                    results.sort((a, b) => b.relevance - a.relevance);
                    highlightSearchResults(query);
                    results[0].element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    alert('Geen resultaten gevonden voor "' + query + '"');
                }
            }
            
            function calculateRelevance(content, query) {
                const queryWords = query.split(' ');
                let score = 0;
                
                queryWords.forEach(word => {
                    const regex = new RegExp(word, 'gi');
                    const matches = content.match(regex);
                    if (matches) {
                        score += matches.length;
                    }
                });
                
                return score;
            }
            
            function highlightSearchResults(query) {
                // Remove existing highlights
                document.querySelectorAll('.search-highlight').forEach(el => {
                    el.classList.remove('search-highlight');
                });
                
                // Add new highlights
                const queryWords = query.split(' ');
                queryWords.forEach(word => {
                    if (word.length > 2) { // Only highlight words longer than 2 characters
                        const regex = new RegExp(`(${word})`, 'gi');
                        const walker = document.createTreeWalker(
                            document.body,
                            NodeFilter.SHOW_TEXT,
                            null,
                            false
                        );
                        
                        const textNodes = [];
                        let node;
                        while (node = walker.nextNode()) {
                            textNodes.push(node);
                        }
                        
                        textNodes.forEach(textNode => {
                            if (textNode.textContent.toLowerCase().includes(word)) {
                                const parent = textNode.parentElement;
                                if (parent && !parent.classList.contains('search-highlight')) {
                                    parent.classList.add('search-highlight');
                                }
                            }
                        });
                    }
                });
                
                // Remove highlights after 5 seconds
                setTimeout(() => {
                    document.querySelectorAll('.search-highlight').forEach(el => {
                        el.classList.remove('search-highlight');
                    });
                }, 5000);
            }
            
            // Event listeners
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        });
    </script>

