<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title ?? 'Thila Coloma' }} - Scoutsgroep Mechelen</title>
    <meta name="description" content="{{ meta_description ?? 'Thila Coloma - Scoutsgroep Mechelen' }}">
    <link rel="stylesheet" href="/assets/css/variables.css">
    <link rel="stylesheet" href="/assets/css/fonts.css">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/pages.css">
    <link rel="stylesheet" href="/assets/css/navigation.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/header.css?v=20250912-2">
    <link rel="stylesheet" href="/assets/css/uniform-buttons.css">
    <link rel="stylesheet" href="https://use.typekit.net/rae0xxq.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- Search Dropdown CSS Fix - v20250912-2 -->
    <style>
        /* Ensure header content allows overflow for dropdown */
        .simple-header-content {
            position: relative;
            overflow: visible !important;
        }
        
        /* Search container positioning */
        .search-container {
            position: relative;
        }
        
        /* Ensure search input has proper border radius when dropdown is open */
        .search-container.has-dropdown .search-input {
            border-radius: 8px 8px 0 0 !important;
            border-bottom: none !important;
        }
        
        /* Search dropdown positioning and styling - only target the search dropdown specifically */
        .search-container .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            width: 100%;
            max-height: 400px;
            background: white;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e8e8e8;
            border-top: none;
            z-index: 1000;
            overflow: hidden;
            margin-top: 0;
            box-sizing: border-box;
        }
        
        .search-container .search-dropdown.hidden {
            display: none !important;
        }
        
        /* Search results styling - only inside search dropdown */
        .search-container .search-results {
            max-height: 350px;
            overflow-y: auto;
        }
        
        .search-container .search-result-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
            transition: background-color 0.15s ease;
            position: relative;
            margin: 0;
            border-left: none;
            border-right: none;
        }
        
        .search-container .search-result-item:hover,
        .search-container .search-result-item.highlighted {
            background: #f8f9fa;
            border-left: none;
            border-right: none;
        }
        
        .search-container .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-container .search-result-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            background: #f0f1f2;
            border-radius: 6px;
        }
        
        .search-container .search-result-icon i {
            font-size: 12px;
            color: var(--primary-color, #3747a0);
        }
        
        .search-container .search-svg-icon {
            width: 14px;
            height: 14px;
        }
        
        .search-container .search-result-content {
            flex: 1;
        }
        
        .search-container .search-result-title {
            font-weight: 500;
            color: #2d3748;
            font-size: 14px;
            margin-bottom: 2px;
            font-family: var(--font-medium, sans-serif);
        }
        
        .search-container .search-result-description {
            font-size: 12px;
            color: #6b7280;
            font-family: var(--font-regular, sans-serif);
        }
        
        .search-container .search-loading,
        .search-container .search-no-results {
            padding: 20px;
            text-align: center;
            color: #6b7280;
            font-size: 13px;
            font-family: var(--font-regular, sans-serif);
        }
        
        .search-container .search-loading i {
            margin-right: 6px;
            color: var(--primary-color, #3747a0);
        }
        
        /* Responsive adjustments - only for search dropdown */
        @media (max-width: 768px) {
            .search-container .search-dropdown {
                width: 100%;
                right: 0;
            }
        }
        
        @media (max-width: 480px) {
            .search-container .search-dropdown {
                width: 100%;
                right: 0;
            }
        }
    </style>
</head>
<body>
    <header class="simple-header" id="main-header">
        <div class="simple-header-content">
            <a href="/" class="nav-icon" title="Home">
                <img src="/assets/images/Logo_TC_KLEUR.png" alt="Home">
            </a>
            <nav class="simple-nav">
                <a href="/thilala" class="nav-icon" title="Thilala">
                    <img src="assets/images/icons/Asset 11thilala.svg" alt="Thilala">
                </a>
                <a href="/stamhoofd" class="nav-icon" title="Stamhoofd">
                    <img src="assets/images/icons/Asset 1stamhoofd.svg" alt="Stamhoofd">
                </a>
                <a href="/kalender" class="nav-icon" title="Kalender">
                    <img src="assets/images/icons/Asset 12agenda.svg" alt="Kalender">
                </a>
                <a href="/takken" class="nav-icon" title="Takken">
                    <img src="assets/images/icons/Asset 7takken.svg" alt="Takken">
                </a>
                <a href="/verhuur" class="nav-icon" title="Verhuur">
                    <img src="assets/images/icons/Asset 13verhuur.svg" alt="Verhuur">
                </a>
                <a href="/meer" class="nav-icon nav-meer" title="Meer">
                    <img src="assets/images/icons/Asset 19meer.svg" alt="Meer">
                </a>
            </nav>
            <div class="header-actions">
                <div class="search-container" id="live-search-container">
                    <input type="text" id="search-input" placeholder="Zoeken..." class="search-input" autocomplete="off">
                    <button type="button" id="search-button" class="search-button" title="Zoeken">
                        <i class="fas fa-search"></i>
                    </button>
                    <div id="search-dropdown" class="search-dropdown hidden">
                        <div class="search-results" id="search-results">
                            <!-- Results will be populated here -->
                        </div>
                        <div class="search-loading hidden" id="search-loading">
                            <i class="fas fa-spinner fa-spin"></i> Zoeken...
                        </div>
                        <div class="search-no-results hidden" id="search-no-results">
                            Geen resultaten gevonden
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Invisible hover zone for header -->
    <div class="header-hover-zone" id="header-hover-zone"></div>

    <main class="page-content">
        {{ template_content }}
    </main>

    <footer class="page-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Contact</h3>
                <p>Thila Coloma Mechelen</p>
                <p>Jubellaan / Geerdegemstraat</p>
                <p>Email: info@thilacoloma.be</p>
            </div>
            <div class="footer-section">
                <h3>Sociale Media</h3>
                <div class="social-links">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Links</h3>
                <a href="https://stamhoofd.thilacoloma.be" target="_blank">Stamhoofd</a>
                <a href="/meer#contact">Contact</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Thila Coloma Mechelen</p>
        </div>
    </footer>

    
    <script src="components/components.js"></script>
    
    <script>
        // Enhanced header scroll behavior with proper iframe detection
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.getElementById('main-header');
            const hoverZone = document.getElementById('header-hover-zone');
            let lastScrollTop = 0;
            let hideTimer = null;
            let isHeaderHidden = false;
            let scrollDirection = 'none';
            let scrollDistance = 0;
            
            function showHeader() {
                header.classList.remove('header-hidden');
                isHeaderHidden = false;
                clearTimeout(hideTimer);
                hoverZone.style.pointerEvents = 'none';
                console.log('Header shown');
            }
            
            function hideHeader() {
                header.classList.add('header-hidden');
                isHeaderHidden = true;
                hoverZone.style.pointerEvents = 'auto';
                console.log('Header hidden');
            }
            
            function hideHeaderWithDelay(delay = 2000) {
                clearTimeout(hideTimer);
                console.log(`Scheduling header hide in ${delay}ms`);
                hideTimer = setTimeout(() => {
                    hideHeader();
                }, delay);
            }
            
            // Check if there's a significant iframe visible in viewport
            function getIframeViewportCoverage() {
                const iframes = document.querySelectorAll('iframe');
                const viewportHeight = window.innerHeight;
                let maxCoverage = 0;
                
                for (let iframe of iframes) {
                    const rect = iframe.getBoundingClientRect();
                    
                    // Skip iframes that are not visible
                    if (rect.height < 100 || rect.width < 100) continue;
                    
                    // Calculate visible portion of iframe
                    const visibleTop = Math.max(0, rect.top);
                    const visibleBottom = Math.min(viewportHeight, rect.bottom);
                    const visibleHeight = Math.max(0, visibleBottom - visibleTop);
                    
                    // Calculate coverage percentage
                    const coverage = visibleHeight / viewportHeight;
                    maxCoverage = Math.max(maxCoverage, coverage);
                    
                    console.log(`Iframe coverage: ${(coverage * 100).toFixed(1)}%`);
                }
                
                return maxCoverage;
            }
            
            // Main scroll handling logic
            function handleScroll() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const previousDirection = scrollDirection;
                
                // Determine scroll direction and distance
                if (scrollTop > lastScrollTop) {
                    scrollDirection = 'down';
                    scrollDistance = scrollTop - lastScrollTop;
                } else if (scrollTop < lastScrollTop) {
                    scrollDirection = 'up';
                    scrollDistance = lastScrollTop - scrollTop;
                } else {
                    scrollDirection = 'none';
                    scrollDistance = 0;
                }
                
                const iframeCoverage = getIframeViewportCoverage();
                const hasSignificantIframe = iframeCoverage > 0.25; // 25% of viewport
                
                console.log(`Scroll: ${scrollDirection}, Distance: ${scrollDistance}, Iframe coverage: ${(iframeCoverage * 100).toFixed(1)}%`);
                
                // Show header when at very top
                if (scrollTop < 50) {
                    showHeader();
                }
                // When iframe is visible, header hides more aggressively
                else if (hasSignificantIframe) {
                    if (scrollDirection === 'down' && scrollDistance > 3) {
                        // Very fast hide when scrolling down with iframe visible
                        hideHeaderWithDelay(300);
                        console.log('Ultra fast hide - iframe + scroll down');
                    } else if (scrollDirection === 'up' && scrollDistance > 10) {
                        // Still hide when scrolling up with iframe, but with delay
                        hideHeaderWithDelay(800);
                        console.log('Delayed hide - iframe + scroll up');
                    }
                }
                // Normal content behavior - show on scroll up, hide on scroll down
                else {
                    if (scrollDirection === 'up' && scrollDistance > 5) {
                        showHeader();
                        console.log('Show header - scroll up without iframe');
                    } else if (scrollDirection === 'down' && scrollTop > 100 && scrollDistance > 5) {
                        hideHeaderWithDelay(1500);
                        console.log('Normal hide - scroll down without iframe');
                    }
                }
                
                lastScrollTop = scrollTop;
            }
            
            // Mouse interactions with header zone
            hoverZone.addEventListener('mouseenter', function() {
                console.log('Mouse entered header zone');
                if (isHeaderHidden) {
                    showHeader();
                }
            });
            
            // Detect mouse movement toward top of screen
            document.addEventListener('mousemove', function(e) {
                // If mouse is in top 15% of screen and header is hidden, show it
                if (e.clientY < window.innerHeight * 0.15 && isHeaderHidden && window.pageYOffset > 100) {
                    console.log('Mouse near top, showing header');
                    showHeader();
                }
            });
            
            // Immediate hide when clicking on iframe
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'IFRAME' || e.target.closest('.kampas-container, .stamhoofd-container')) {
                    console.log('Clicked on iframe area, hiding header');
                    hideHeaderWithDelay(500);
                }
            });
            
            // Throttled scroll event
            let scrollTimeout = null;
            window.addEventListener('scroll', function() {
                if (scrollTimeout) return;
                scrollTimeout = setTimeout(() => {
                    handleScroll();
                    scrollTimeout = null;
                }, 50); // Slightly slower throttle for better debugging
            });
            
            // Show header on ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    console.log('ESC pressed, showing header');
                    showHeader();
                }
            });
            
            // Set active navigation state
            function setActiveNavigation() {
                const currentPath = window.location.pathname;
                const navLinks = document.querySelectorAll('.nav-icon');
                
                // Remove active class from all nav links
                navLinks.forEach(link => link.classList.remove('active'));
                
                // Add active class to current page nav link
                navLinks.forEach(link => {
                    const linkPath = new URL(link.href, window.location.origin).pathname;
                    if (currentPath === linkPath || 
                        (currentPath === '/' && link.title === 'Home') ||
                        (currentPath.startsWith('/kapoenen') && linkPath === '/takken') ||
                        (currentPath.startsWith('/welpen') && linkPath === '/takken') ||
                        (currentPath.startsWith('/tictak') && linkPath === '/takken') ||
                        (currentPath.startsWith('/jongverkenners') && linkPath === '/takken') ||
                        (currentPath.startsWith('/verkenners') && linkPath === '/takken') ||
                        (currentPath.startsWith('/voortrekkers') && linkPath === '/takken')) {
                        link.classList.add('active');
                    }
                });
            }
            
            // Set active navigation on page load
            setActiveNavigation();
            
            // Initial check after page load
            setTimeout(() => {
                const iframeCoverage = getIframeViewportCoverage();
                if (iframeCoverage > 0.4 && window.pageYOffset > 200) {
                    console.log('Initial iframe detected, hiding header');
                    hideHeaderWithDelay(1000);
                }
            }, 2000);
        });
        
        // Live Search functionality - Updated v1.1
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const searchDropdown = document.getElementById('search-dropdown');
            const searchResults = document.getElementById('search-results');
            const searchLoading = document.getElementById('search-loading');
            const searchNoResults = document.getElementById('search-no-results');
            const searchContainer = document.getElementById('live-search-container');
            
            let searchTimeout;
            let currentHighlighted = -1;
            let searchCache = new Map();
            
            function showDropdown() {
                searchDropdown.classList.remove('hidden');
                searchContainer.classList.add('has-dropdown');
            }
            
            function hideDropdown() {
                searchDropdown.classList.add('hidden');
                searchContainer.classList.remove('has-dropdown');
                currentHighlighted = -1;
            }
            
            function showLoading() {
                searchLoading.classList.remove('hidden');
                searchResults.classList.add('hidden');
                searchNoResults.classList.add('hidden');
            }
            
            function hideLoading() {
                searchLoading.classList.add('hidden');
            }
            
            function showNoResults() {
                searchNoResults.classList.remove('hidden');
                searchResults.classList.add('hidden');
            }
            
            function showResults() {
                searchResults.classList.remove('hidden');
                searchNoResults.classList.add('hidden');
            }
            
            function renderResults(results) {
                hideLoading();
                
                if (results.length === 0) {
                    showNoResults();
                    return;
                }
                
                showResults();
                
                searchResults.innerHTML = results.map((result, index) => {
                    const icon = result.icon || 'fas fa-file-alt';
                    let iconHtml = '';
                    
                    if (icon.startsWith('/assets/images/')) {
                        // SVG icon from header - use a simpler approach
                        iconHtml = `<img src="${icon}" alt="Icon" class="search-svg-icon">`;
                    } else {
                        // FontAwesome icon
                        iconHtml = `<i class="${icon}"></i>`;
                    }
                    
                    return `
                    <div class="search-result-item" data-url="${result.url}" data-index="${index}">
                        <div class="search-result-icon">
                            ${iconHtml}
                        </div>
                        <div class="search-result-content">
                            <div class="search-result-title">${result.title}</div>
                            <div class="search-result-description">${result.description || ''}</div>
                        </div>
                    </div>`;
                }).join('');
                
                // Add click listeners to result items
                searchResults.querySelectorAll('.search-result-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const url = this.getAttribute('data-url');
                        if (url) {
                            window.location.href = url;
                        }
                    });
                });
                
                // Make sure dropdown is visible after rendering results
                showDropdown();
            }
            
            function highlightResult(index) {
                const items = searchResults.querySelectorAll('.search-result-item');
                
                // Remove previous highlight
                items.forEach(item => item.classList.remove('highlighted'));
                
                // Add highlight to current item
                if (index >= 0 && index < items.length) {
                    items[index].classList.add('highlighted');
                    currentHighlighted = index;
                } else {
                    currentHighlighted = -1;
                }
            }
            
            function performSearch(query) {
                query = query.trim();
                
                if (query.length < 1) {
                    hideDropdown();
                    return;
                }
                
                // Check cache first
                if (searchCache.has(query)) {
                    renderResults(searchCache.get(query));
                    showDropdown();
                    return;
                }
                
                showDropdown();
                showLoading();
                
                fetch(`/api/search?q=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(results => {
                        // Cache the results
                        searchCache.set(query, results);
                        renderResults(results);
                    })
                    .catch(error => {
                        console.error('Search error:', error);
                        hideLoading();
                        showNoResults();
                    });
            }
            
            // Handle input changes
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const query = this.value;
                    
                    // Clear existing timeout
                    if (searchTimeout) {
                        clearTimeout(searchTimeout);
                    }
                    
                    // Debounce search
                    searchTimeout = setTimeout(() => {
                        performSearch(query);
                    }, 300);
                });
                
                // Handle keyboard navigation
                searchInput.addEventListener('keydown', function(e) {
                    const items = searchResults.querySelectorAll('.search-result-item');
                    
                    switch(e.key) {
                        case 'ArrowDown':
                            e.preventDefault();
                            const nextIndex = currentHighlighted < items.length - 1 ? currentHighlighted + 1 : 0;
                            highlightResult(nextIndex);
                            break;
                            
                        case 'ArrowUp':
                            e.preventDefault();
                            const prevIndex = currentHighlighted > 0 ? currentHighlighted - 1 : items.length - 1;
                            highlightResult(prevIndex);
                            break;
                            
                        case 'Enter':
                            e.preventDefault();
                            if (currentHighlighted >= 0 && items[currentHighlighted]) {
                                const url = items[currentHighlighted].getAttribute('data-url');
                                if (url) {
                                    window.location.href = url;
                                }
                            } else {
                                // If no result is highlighted, perform traditional search if needed
                                const query = this.value.trim();
                                if (query && items.length > 0) {
                                    // Navigate to first result
                                    const firstUrl = items[0].getAttribute('data-url');
                                    if (firstUrl) {
                                        window.location.href = firstUrl;
                                    }
                                }
                            }
                            break;
                            
                        case 'Escape':
                            hideDropdown();
                            this.blur();
                            break;
                    }
                });
                
                // Show dropdown when input gets focus (if there's content)
                searchInput.addEventListener('focus', function() {
                    if (this.value.trim().length >= 1) {
                        performSearch(this.value.trim());
                    }
                });
                
                // Auto-focus search when typing "/" key anywhere on page
                document.addEventListener('keydown', function(e) {
                    if (e.key === '/' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                        e.preventDefault();
                        searchInput.focus();
                    }
                });
            }
            
            // Handle search button (go to best result)
            if (searchButton) {
                searchButton.addEventListener('click', function() {
                    const query = searchInput.value.trim();
                    if (query) {
                        // First try to get results
                        fetch(`/api/search?q=${encodeURIComponent(query)}`)
                            .then(response => response.json())
                            .then(results => {
                                if (results && results.length > 0) {
                                    // Go to the best result (first one)
                                    window.location.href = results[0].url;
                                } else {
                                    console.log('No results found for:', query);
                                }
                            })
                            .catch(error => {
                                console.error('Search button error:', error);
                            });
                    }
                });
            }
            
            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!document.getElementById('live-search-container').contains(e.target)) {
                    hideDropdown();
                }
            });
        });
    </script>
    
    <!-- Force cache override for materiaal cards styling -->
    <style>
        /* Force reset any cached conflicting styles */
        .materiaal-item h4 {
            font-size: 1em !important;
            font-family: var(--font-medium) !important;
            color: var(--primary-color) !important;
        }
        
        .materiaal-pricing div {
            font-size: 0.9em !important;
        }
        
        .materiaal-count {
            font-size: 1em !important;
            font-family: var(--font-bold) !important;
        }
        
        /* Word break for long names like Aanhangwagen */
        .materiaal-item h4 {
            word-break: break-word;
            hyphens: auto;
            -webkit-hyphens: auto;
            -moz-hyphens: auto;
        }
    </style>
</body>
</html>
